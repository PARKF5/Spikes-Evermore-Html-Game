<!DOCTYPE html>
<html>
<head>
<title>Spikes Evermore</title>
<style>
body {
    margin: 0;
    overflow: hidden;
    background-color: #333;
    color: white;
    font-family: sans-serif;
}
canvas {
    border: 1px solid #fff;
    display: block;
    margin: 20px auto;
}
/* New style for the level counter */
#levelCounter {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 24px;
}
/* New style for the win screen container */
#winScreen {
    display: none; /* Hidden by default */
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    justify-content: center;
    align-items: center;
    flex-direction: column;
    text-align: center;
}
#winScreen h1 {
    font-size: 48px;
    color: #4CAF50;
}
#winScreen p {
    font-size: 24px;
}
</style>
</head>
<body>
<div id="levelCounter">Level: 1</div>
<canvas id="gameCanvas" width="800" height="600"></canvas>

<!-- Win screen container -->
<div id="winScreen">
    <h1>You Win!</h1>
    <p>Congratulations, you reached Level <span id="winLevelDisplay"></span>!</p>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const levelCounter = document.getElementById('levelCounter');
const winScreen = document.getElementById('winScreen');
const winLevelDisplay = document.getElementById('winLevelDisplay');

// Game state variables
let level = 1;
const WIN_LEVEL = 4; // Variable to set the winning level

// Player properties
const player = {
    x: 50,
    y: canvas.height - 50,
    width: 30,
    height: 30,
    color: 'blue',
    xspeed: 5,
    yspeed: 2,
    dx: 0,
    dy: 0
};

// Next level box properties
const nextLevelBox = {
    x: 700,
    y: canvas.height - 80,
    width: 50,
    height: 80,
    color: 'green'
};

// Spike properties
let spikes = [];

function initializeSpikes() {
    if (level === 1) {
        spikes = [
            { x: 200, y: canvas.height - 0, width: 20, height: 30, initialY: canvas.height - 0, movementRange: 90, speed: 1.2, direction: -1, shape: 'square', movementType: 'vertical' },
            { x: 350, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 80, speed: 1.4, direction: -1, shape: 'square', movementType: 'vertical' },
            { x: 500, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 70, speed: 1.6, direction: -1, shape: 'square', movementType: 'vertical' },
        ];
    } else if (level === 2) {
        spikes = [
            { x: 150, y: canvas.height - 0, width: 20, height: 30, initialY: canvas.height - 0, movementRange: 100, speed: 1.5, direction: -1, shape: 'square', movementType: 'vertical' },
            { x: 300, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 90, speed: 1.7, direction: -1, shape: 'square', movementType: 'vertical' },
            { x: 450, y: canvas.height - 0, width: 20, height: 30, initialY: canvas.height - 0, movementRange: 80, speed: 1.9, direction: -1, shape: 'square', movementType: 'vertical' },
            { x: 600, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 70, speed: 2.1, direction: -1, shape: 'square', movementType: 'vertical' },
        ];
    } else if (level === 3) {
        spikes = [
            { x: 100, y: canvas.height - 0, width: 20, height: 30, initialY: canvas.height - 0, movementRange: 120, speed: 2.0, direction: -1, shape: 'square', movementType: 'vertical' },
            { x: 250, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 110, speed: 2.2, direction: -1, shape: 'square', movementType: 'vertical' },
            { x: 400, y: canvas.height - 0, width: 20, height: 30, initialY: canvas.height - 0, movementRange: 100, speed: 2.4, direction: -1, shape: 'square', movementType: 'vertical' },
            { x: 550, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 90, speed: 2.6, direction: -1, shape: 'square', movementType: 'vertical' },
            { x: 700, y: canvas.height - 0, width: 20, height: 30, initialY: canvas.height - 0, movementRange: 80, speed: 2.8, direction: -1, shape: 'square', movementType: 'vertical' },
        ];
    } else {
        // Handle case where level is higher than defined levels, or just reset/end game
        spikes = [];
    }
}

function resetPlayerPosition() {
    player.x = 50;
    player.y = canvas.height - 50;
    player.dx = 0;
    player.dy = 0;
}

function nextLevel() {
    level++;
    if (level > WIN_LEVEL) {
        // Win condition met
        showWinScreen();
    } else {
        initializeSpikes();
        resetPlayerPosition();
        levelCounter.textContent = 'Level: ' + level;
    }
}

function showWinScreen() {
    winLevelDisplay.textContent = WIN_LEVEL;
    winScreen.style.display = 'flex'; // Show the win screen
    // Stop the game loop (optional, depending on desired behavior)
    // For now, the game loop will continue running but the win screen is visible
}

function drawPlayer() {
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.width, player.height);
}

function drawNextLevelBox() {
    ctx.fillStyle = nextLevelBox.color;
    ctx.fillRect(nextLevelBox.x, nextLevelBox.y, nextLevelBox.width, nextLevelBox.height);
}

function drawSpikes() {
    ctx.fillStyle = 'red';
    spikes.forEach(spike => {
        if (spike.shape === 'square') {
            ctx.fillRect(spike.x, spike.y - spike.height, spike.width, spike.height);
        }
        // More shapes could be added here
    });
}

function updatePlayer() {
    player.x += player.dx;
    // Simple gravity/jump physics (need a floor or platform logic to work properly)
    // For this simple game, we just use key movements and boundaries
    
    // Boundary checks
    if (player.x + player.width > canvas.width) {
        player.x = canvas.width - player.width;
    }
    if (player.x < 0) {
        player.x = 0;
    }
    // Vertical movement not implemented in original snippet, so player stays on the floor
    player.y = canvas.height - player.height; 
}

function updateSpikes() {
    spikes.forEach(spike => {
        if (spike.movementType === 'vertical') {
            spike.y += spike.speed * spike.direction;
            if (spike.y <= spike.initialY - spike.movementRange || spike.y >= spike.initialY) {
                spike.direction *= -1;
            }
        }
    });
}

function checkCollisions() {
    // Player with spikes
    spikes.forEach(spike => {
        if (player.x < spike.x + spike.width &&
            player.x + player.width > spike.x &&
            player.y < spike.y &&
            player.y + player.height > spike.y - spike.height) {
            // Collision detected, reset level
            resetPlayerPosition();
        }
    });

    // Player with next level box
    if (player.x < nextLevelBox.x + nextLevelBox.width &&
        player.x + player.width > nextLevelBox.x &&
        player.y < nextLevelBox.y + nextLevelBox.height &&
        player.y + player.height > nextLevelBox.y) {
        // Reached end point, go to next level
        nextLevel();
    }
}

function handleKeyDown(e) {
    if (winScreen.style.display !== 'flex') { // Only allow movement if win screen is not displayed
        if (e.key === 'Right' || e.key === 'ArrowRight') {
            player.dx = player.xspeed;
        } else if (e.key === 'Left' || e.key === 'ArrowLeft') {
            player.dx = -player.xspeed;
        }
    }
}

function handleKeyUp(e) {
    if (e.key === 'Right' || e.key === 'ArrowRight' || e.key === 'Left' || e.key === 'ArrowLeft') {
        player.dx = 0;
    }
}

document.addEventListener('keydown', handleKeyDown);
document.addEventListener('keyup', handleKeyUp);

function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (winScreen.style.display !== 'flex') {
        drawNextLevelBox();
        drawSpikes();
        drawPlayer();
        updatePlayer();
        updateSpikes();
        checkCollisions();
    }

    requestAnimationFrame(gameLoop);
}

// Initial setup
initializeSpikes();
gameLoop();
</script>
</body>
</html>
