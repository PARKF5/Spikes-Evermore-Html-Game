<!DOCTYPE html>
<html>
<head>
<title>Spikes Evermore</title>
<style>
body {
  margin: 0;
  overflow: hidden;
  background-color: #333;
  color: white;
  font-family: sans-serif;
}
canvas {
  border: 1px solid #fff;
  display: block;
  margin: 20px auto;
}
/* New style for the level counter */
#levelCounter {
  position: absolute;
  top: 10px;
  left: 10px;
  font-size: 24px;
}
/* New style for the win screen */
#winScreen {
  display: none; /* Hidden by default */
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  justify-content: center;
  align-items: center;
  flex-direction: column;
  text-align: center;
}
#winScreen h1 {
  font-size: 48px;
  color: #4CAF50; /* Green color for win message */
}
#winScreen p {
  font-size: 24px;
}
</style>
</head>
<body>
<div id="levelCounter">Level: 1</div>
<canvas id="gameCanvas" width="800" height="600"></canvas>
<div id="winScreen">
  <h1>You Win!</h1>
  <p id="winMessage">You have reached level 4!</p>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const levelCounter = document.getElementById('levelCounter');
const winScreen = document.getElementById('winScreen');
const winMessage = document.getElementById('winMessage');

// --- Game Configuration ---
// Make the level you win at a variable
const WIN_LEVEL = 4;

// Game state variables
let level = 1;
let gameWon = false;

// Player properties
const player = {
  x: 50,
  y: canvas.height - 50,
  width: 30,
  height: 30,
  color: 'blue',
  xspeed: 5,
  yspeed: 2,
  dx: 0,
  dy: 0
};

// Next level box properties
const nextLevelBox = {
  x: 700, // Position after the spikes
  y: canvas.height - 80,
  width: 50,
  height: 80,
  color: 'green'
};

// Spike properties (defined in a function to allow resetting for new levels)
let spikes = [];

function initializeSpikes() {
  if (level === 1) {
    spikes = [
      // Vertical spikes (squares used as spikes)
      { x: 200, y: canvas.height - 0, width: 20, height: 30, initialY: canvas.height - 0, movementRange: 90, speed: 1.2, direction: -1, shape: 'square', movementType: 'vertical' },
      { x: 350, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 80, speed: 1.4, direction: -1, shape: 'square', movementType: 'vertical' },
      { x: 500, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 70, speed: 1.6, direction: -1, shape: 'square', movementType: 'vertical' },
    ];
  } else if (level === 2) {
    // More complex level 2
    spikes = [
      { x: 150, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 50, speed: 1.5, direction: -1, shape: 'square', movementType: 'vertical' },
      { x: 250, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 70, speed: 2.0, direction: -1, shape: 'square', movementType: 'vertical' },
      { x: 350, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 90, speed: 2.5, direction: -1, shape: 'square', movementType: 'vertical' },
      { x: 450, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 90, speed: 2.5, direction: -1, shape: 'square', movementType: 'vertical' },
      { x: 550, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 70, speed: 2.0, direction: -1, shape: 'square', movementType: 'vertical' },
      { x: 650, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 50, speed: 1.5, direction: -1, shape: 'square', movementType: 'vertical' },
    ];
  } else if (level === 3) {
      // Even more complex level 3
      spikes = [
        { x: 100, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 100, speed: 1.8, direction: -1, shape: 'square', movementType: 'vertical' },
        { x: 200, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 60, speed: 2.2, direction: -1, shape: 'square', movementType: 'vertical' },
        { x: 300, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 110, speed: 2.5, direction: -1, shape: 'square', movementType: 'vertical' },
        { x: 400, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 80, speed: 2.0, direction: -1, shape: 'square', movementType: 'vertical' },
        { x: 500, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 120, speed: 2.8, direction: -1, shape: 'square', movementType: 'vertical' },
        { x: 600, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 70, speed: 2.1, direction: -1, shape: 'square', movementType: 'vertical' },
        { x: 700, y: canvas.height - 30, width: 20, height: 30, initialY: canvas.height - 30, movementRange: 90, speed: 2.4, direction: -1, shape: 'square', movementType: 'vertical' },
      ];
  }
}

// Event listeners for movement
document.addEventListener('keydown', (e) => {
  if (gameWon) return; // Ignore input if game is won
  if (e.key === 'ArrowRight') player.dx = player.xspeed;
  if (e.key === 'ArrowLeft') player.dx = -player.xspeed;
  if (e.key === 'ArrowUp') player.dy = -player.yspeed;
  if (e.key === 'ArrowDown') player.dy = player.yspeed;
});

document.addEventListener('keyup', (e) => {
  if (gameWon) return; // Ignore input if game is won
  if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') player.dx = 0;
  if (e.key === 'ArrowUp' || e.key === 'ArrowDown') player.dy = 0;
});

// Collision detection utility
function isColliding(rect1, rect2) {
  return rect1.x < rect2.x + rect2.width &&
         rect1.x + rect1.width > rect2.x &&
         rect1.y < rect2.y + rect2.height &&
         rect1.y + rect1.height > rect2.y;
}

// Function to handle player death and reset level
function playerDies() {
  player.x = 50;
  player.y = canvas.height - 50;
  // Optional: reset spikes movement state if needed, but the current logic handles it per frame.
}

// Function to advance the level or win the game
function nextLevel() {
    if (level >= WIN_LEVEL) {
        gameWon = true;
        winMessage.textContent = `You have reached level ${WIN_LEVEL}!`;
        winScreen.style.display = 'flex';
        return;
    }
    level++;
    levelCounter.textContent = `Level: ${level}`;
    initializeSpikes(); // Setup spikes for the new level
    // Reset player position
    player.x = 50;
    player.y = canvas.height - 50;
}

// Update game objects position and state
function update() {
  if (gameWon) return; // Stop game logic if won

  // Move player
  player.x += player.dx;
  player.y += player.dy;

  // Boundary checks for player
  if (player.x < 0) player.x = 0;
  if (player.x + player.width > canvas.width) player.x = canvas.width - player.width;
  if (player.y < 0) player.y = 0;
  if (player.y + player.height > canvas.height) player.y = canvas.height - player.height;

  // Move spikes
  spikes.forEach(spike => {
    if (spike.movementType === 'vertical') {
      spike.y += spike.speed * spike.direction;

      // Reverse direction if boundaries are hit
      if (spike.y <= spike.initialY - spike.movementRange || spike.y + spike.height >= spike.initialY + spike.height) {
        spike.direction *= -1;
      }
    }
  });

  // Check for collisions
  // Spike collisions
  spikes.forEach(spike => {
    if (isColliding(player, spike)) {
      playerDies();
    }
  });

  // Next level box collision
  if (isColliding(player, nextLevelBox)) {
    nextLevel();
  }
}

// Draw game objects
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (gameWon) return; // Only show canvas clear if game is won (win screen takes over)

  // Draw player
  ctx.fillStyle = player.color;
  ctx.fillRect(player.x, player.y, player.width, player.height);

  // Draw spikes
  spikes.forEach(spike => {
    ctx.fillStyle = 'red'; // Spikes are red
    ctx.fillRect(spike.x, spike.y, spike.width, spike.height);
  });

  // Draw next level box
  ctx.fillStyle = nextLevelBox.color;
  ctx.fillRect(nextLevelBox.x, nextLevelBox.y, nextLevelBox.width, nextLevelBox.height);
}

// Game loop
function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

// Initialize the game
initializeSpikes(); // Setup initial spikes
gameLoop();
</script>
</body>
</html>
